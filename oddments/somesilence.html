<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

  <title>Silence, sometimes interrupted</title>
  <meta name="description" content="Template">

  <style>
  </style>
</head>
<body>
  <div id="main">
    <div id="inputs">
        <input type="file" id="upload" /> <br />
        <label for="endlo">Minimum delay:</label> <input type="number" id="endlo" value="60" /><br />
        <label for="endhi">Maximum delay:</label> <input type="number" id="endhi" value="1200" /><br />

        <input type="button" id="go" value="Go!" onclick="go()"/>
        <input type="button" id="stop" value="Stop!" onclick="stop()"/>
    </div>
    <div id="audios">

        <audio id="audio" controls>
          <source src="" id="src" />
        </audio>
    </div>
  </div>
  
  <script>
    function handleFiles(event) {
        var files = event.target.files;
        $("#src").attr("src", URL.createObjectURL(files[0]));
        document.getElementById("audio").load();
    }

    document.getElementById("upload").addEventListener("change", handleFiles, false);

    var cur = 0;

    function go() {
        let inpFile = document.getElementById("upload").files[0];
        let inpLo = parseFloat(document.getElementById("endlo").value);
        let inpHi = parseFloat(document.getElementById("endhi").value);
        let elemAudio = document.getElementById("audio");

        if (inpFile == null || isNaN(inpLo) || isNaN(inpHi) || inpLo >= inpHi) {
            return;
        }

        let delay = ((Math.random() * (inpHi - inpLo)) + inpLo) * 1000;

        setTimeout(looper, delay, cur, inpLo, inpHi, elemAudio);
    }

    function stop() {
        ++cur;
    }

    function looper(id, limLo, limHi, elemAudio) {
        if (id != cur) {
            return;
        }

        elemAudio.currentTime = 0;
        elemAudio.play();

        let delay = ((Math.random() * (limHi - limLo + 1)) + limLo) * 1000;

        setTimeout(looper, delay, id, limLo, limHi, elemAudio);
    }
  </script>
</body>
</html>
